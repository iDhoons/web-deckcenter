---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import Hero3D from '../components/Hero3D.astro';
import TrustIndicators from '../components/TrustIndicators.astro';
import Features from '../components/Features.astro';
import HowItWorks from '../components/HowItWorks.astro';
import MaterialShowcase from '../components/MaterialShowcase.astro';
import Testimonial from '../components/Testimonial.astro';
import Pricing from '../components/Pricing.astro';

const trustStats = [
  { value: '10,000+', label: '설계 완료' },
  { value: '5,000+', label: '활성 사용자' },
  { value: '98%', label: '만족도' },
  { value: '24/7', label: '지원' },
];

const materials = [
  {
    id: 'western-red-cedar',
    name: '서부 레드 시더',
    nameEn: 'Western Red Cedar',
    category: 'wood' as const,
    price: '₩55,000 / m²',
    image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600&q=80',
  },
  {
    id: 'ipe- hardwood',
    name: '이페 하드우드',
    nameEn: 'Ipe Hardwood',
    category: 'wood' as const,
    price: '₩120,000 / m²',
    image: 'https://images.unsplash.com/photo-1513519245088-0e12902e35a6?w=600&q=80',
  },
  {
    id: 'trex-transcend',
    name: '트렉스 트랜센드',
    nameEn: 'Trex Transcend',
    category: 'composite' as const,
    price: '₩85,000 / m²',
    image: 'https://images.unsplash.com/photo-1600585152220-90363fe7e115?w=600&q=80',
  },
  {
    id: 'aluminum-perforated',
    name: '알루미늄 퍼포레이티드',
    nameEn: 'Aluminum Perforated',
    category: 'aluminum' as const,
    price: '₩150,000 / m²',
    image: 'https://images.unsplash.com/photo-1600607686527-6fb886090705?w=600&q=80',
  },
];

const testimonials = [
  {
    name: '김준영',
    company: '주택개발사',
    content: '데크센터 덕분에 고객에게 실시간으로 3D 데크 설계를 보여줄 수 있어 견적 성공률이 40%나 올랐습니다.',
    rating: 5,
    project: '서초구 아파트 데크 시공',
  },
  {
    name: '이수진',
    company: '인테리어 디자이너',
    content: '자재 라이브러리가 매우 다양해서 다양한 스타일을 제안할 수 있어요. 고객 만족도가 크게 향상되었습니다.',
    rating: 5,
    project: '강남구 빌라 옥상 데크',
  },
  {
    name: '박민수',
    company: '데크 시공 업체',
    content: '자동 견적 산출 기능으로 견적 작성 시간이 1시간에서 10분으로 단축되었습니다. 정말 효율적입니다.',
    rating: 5,
  },
];
---

<BaseLayout>
  <Hero />

  <!-- 3D Hero Section -->
  <section class="hero-3d-section py-16 bg-gradient-to-b from-warm-50 to-bg">
    <div class="max-w-DEFAULT mx-auto px-6">
      <Hero3D />
    </div>
  </section>

  <!-- Trust Indicators -->
  <TrustIndicators stats={trustStats} />

  <!-- Features -->
  <Features />

  <!-- How It Works -->
  <HowItWorks />

  <!-- Material Showcase -->
  <MaterialShowcase materials={materials} />

  <!-- Testimonials -->
  <section class="testimonials-section bg-bg-secondary py-section-spacing" aria-labelledby="testimonials-heading">
    <div class="section-inner max-w-DEFAULT mx-auto px-container">
      <div class="section-header text-center mb-16">
        <h2 id="testimonials-heading" class="text-h2 font-bold text-text mb-3">고객 후기</h2>
        <p class="text-lg text-text-secondary">데크센터를 사용하는 전문가들의 생생한 경험담</p>
      </div>

      <div class="testimonials-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {testimonials.map((testimonial) => (
          <Testimonial {...testimonial} />
        ))}
      </div>
    </div>
  </section>

  <!-- Pricing -->
  <Pricing />

  <!-- Final CTA -->
  <section class="final-cta py-section-spacing bg-gradient-to-br from-primary to-primary-soft">
    <div class="final-cta-inner max-w-DEFAULT mx-auto px-container">
      <div class="final-cta-card bg-warm-50/10 backdrop-blur-sm rounded-3xl p-8 md:p-16 border border-warm-200/20">
        <div class="final-cta-content text-center max-w-2xl mx-auto">
          <span class="final-cta-kicker inline-flex items-center px-4 py-2 rounded-full border border-accent/30 text-accent-light text-sm font-semibold mb-6">
            무료 체험 · 신용카드 불필요
          </span>
          <h2 class="text-3xl md:text-5xl font-bold text-warm-50 mb-6">지금 바로 시작하세요</h2>
          <p class="text-lg text-warm-200 mb-10 leading-relaxed">
            무료로 데크 설계를 체험해 보세요. 3D 설계부터 실시간 견적까지 한 번에 확인할 수 있습니다.
          </p>
          <div class="final-cta-actions flex flex-col sm:flex-row gap-4 justify-center">
            <a href="/app" class="btn-primary inline-flex items-center justify-center gap-2 px-8 py-4 bg-accent hover:bg-accent-light text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-base">
              무료로 시작하기
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
            </a>
            <a href="/features" class="btn-secondary inline-flex items-center justify-center gap-2 px-8 py-4 bg-transparent border-2 border-warm-200 hover:border-warm-100 text-warm-100 hover:text-white font-semibold rounded-xl transition-all duration-base">
              기능 더 알아보기
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  // Hero 애니메이션
  function initHeroAnimations() {
    const heroCopy = document.querySelector('.hero-copy');
    if (!heroCopy) return;

    gsap.from('.hero-kicker, .hero-copy h1, .hero-description, .hero-cta .btn, .hero-trust', {
      y: 30,
      opacity: 0,
      duration: 0.8,
      stagger: 0.15,
      ease: 'power2.out',
      delay: 0.5,
    });
  }

  // Feature cards 애니메이션
  function initFeatureAnimations() {
    const featureCards = document.querySelectorAll('#features article');

    featureCards.forEach((card, index) => {
      gsap.from(card, {
        scrollTrigger: {
          trigger: card,
          start: 'top 80%',
          toggleActions: 'play none none reverse',
        },
        y: 40,
        opacity: 0,
        duration: 0.6,
        delay: index * 0.1,
        ease: 'power2.out',
      });
    });
  }

  // Testimonials 애니메이션
  function initTestimonialAnimations() {
    const testimonialCards = document.querySelectorAll('.testimonial-card');

    testimonialCards.forEach((card, index) => {
      gsap.from(card, {
        scrollTrigger: {
          trigger: card,
          start: 'top 85%',
          toggleActions: 'play none none reverse',
        },
        y: 30,
        opacity: 0,
        duration: 0.5,
        delay: index * 0.1,
        ease: 'power2.out',
      });
    });
  }

  // Section headers 애니메이션
  function initHeaderAnimations() {
    const headers = document.querySelectorAll('.section-header h2, .section-header p');

    headers.forEach((header) => {
      gsap.from(header, {
        scrollTrigger: {
          trigger: header,
          start: 'top 85%',
          toggleActions: 'play none none reverse',
        },
        y: 20,
        opacity: 0,
        duration: 0.5,
        ease: 'power2.out',
      });
    });
  }

  // Init animations
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      initHeroAnimations();
      initFeatureAnimations();
      initTestimonialAnimations();
      initHeaderAnimations();
    });
  } else {
    initHeroAnimations();
    initFeatureAnimations();
    initTestimonialAnimations();
    initHeaderAnimations();
  }

  // Re-init on page navigation
  document.addEventListener('astro:page-load', () => {
    ScrollTrigger.refresh();
    initHeroAnimations();
    initFeatureAnimations();
    initTestimonialAnimations();
    initHeaderAnimations();
  });
</script>

<style>
  .hero-3d-section {
    position: relative;
  }

  /* Testimonials Section */
  .testimonials-section {
    background: var(--color-bg-secondary);
  }

  .section-inner {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: 0 var(--container-padding);
  }

  /* Final CTA Section */
  .final-cta {
    position: relative;
    overflow: hidden;
  }

  .final-cta::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(var(--color-warm-200) 1px, transparent 1px),
      linear-gradient(90deg, var(--color-warm-200) 1px, transparent 1px);
    background-size: 60px 60px;
    opacity: 0.1;
    pointer-events: none;
  }

  .final-cta-inner {
    position: relative;
    z-index: 1;
  }

  .final-cta-card {
    box-shadow: var(--shadow-xl);
  }

  .final-cta-kicker {
    box-shadow: 0 2px 8px rgba(13, 148, 136, 0.2);
  }

  .btn-primary {
    box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(13, 148, 136, 0.4);
  }

  /* Dark mode adjustments */
  [data-theme="dark"] .final-cta {
    background: linear-gradient(to bottom right, var(--color-bg), var(--color-bg-secondary));
  }

  [data-theme="dark"] .final-cta-card {
    background: rgba(255, 255, 255, 0.03);
    border-color: rgba(255, 255, 255, 0.1);
  }

  [data-theme="dark"] .btn-secondary {
    border-color: var(--color-warm-200);
    color: var(--color-warm-100);
  }

  [data-theme="dark"] .btn-secondary:hover {
    border-color: var(--color-warm-100);
    background: rgba(255, 255, 255, 0.05);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .final-cta-content h2 {
      font-size: 2rem;
    }

    .final-cta-content p {
      font-size: 1rem;
    }
  }
</style>
