---
interface Props {
  title: string;
  description: string;
  ctaText?: string;
  ctaLink?: string;
  image?: string;
  videoUrl?: string;
  youtubeId?: string;
  eyebrow?: string;
  highlights?: string[];
}

const {
  title,
  description,
  ctaText,
  ctaLink,
  image,
  videoUrl,
  youtubeId,
  eyebrow,
  highlights,
} = Astro.props;
---

<section class="hero-text">
  <div class="hero-text-inner">
    {eyebrow && <span class="eyebrow">{eyebrow}</span>}
    <h1>{title}</h1>
    <p>{description}</p>
    {ctaText && ctaLink && (
      <a href={ctaLink} class="cta">{ctaText}</a>
    )}
    {highlights && highlights.length > 0 && (
      <ul class="hero-highlights">
        {highlights.map((item) => (
          <li>{item}</li>
        ))}
      </ul>
    )}
  </div>
</section>

<section class="hero-media-section">
  <div class="hero-media">
    {videoUrl ? (
      <video
        src={videoUrl}
        poster={image}
        autoplay
        muted
        loop
        playsinline
        preload="auto"
      ></video>
    ) : youtubeId ? (
      <iframe
        src={`https://www.youtube.com/embed/${youtubeId}?autoplay=1&mute=1&loop=1&playlist=${youtubeId}&controls=0&showinfo=0&rel=0&modestbranding=1`}
        title={title}
        frameborder="0"
        allow="autoplay; encrypted-media"
        allowfullscreen
      ></iframe>
    ) : image ? (
      <img src={image} alt={title} loading="eager" />
    ) : null}
  </div>
</section>

<script>
  function initHeroAnimation() {
    const heroMedia = document.querySelector('.hero-media');
    if (!heroMedia) return;

    // 이미 revealed 상태면 스킵
    if (heroMedia.classList.contains('revealed')) return;

    function revealHero() {
      // 스플래시 완료 후 1초 딜레이
      setTimeout(() => {
        heroMedia.classList.add('revealed');
      }, 1000);
    }

    // 스플래시가 있으면 완료 후 시작, 없으면 1초 후 열림
    const splash = document.getElementById('splash');
    if (splash && !splash.classList.contains('removed')) {
      window.addEventListener('splash:complete', revealHero, { once: true });
    } else {
      setTimeout(() => {
        heroMedia.classList.add('revealed');
      }, 1000);
    }
  }

  // 초기 로드 및 View Transitions 후 모두 실행
  document.addEventListener('astro:page-load', initHeroAnimation);
</script>

<style>
  .hero-text {
    background: var(--color-bg-alt);
    text-align: center;
    padding: 80px 20px;
  }

  .hero-text-inner {
    max-width: var(--max-width);
    margin: 0 auto;
  }

  .eyebrow {
    display: inline-block;
    font-size: 0.9rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--color-accent);
    margin-bottom: 1rem;
    font-weight: 700;
  }

  .hero-text h1 {
    color: var(--color-primary);
    margin-bottom: 1.5rem;
    font-size: 2.75rem;
  }

  .hero-text p {
    font-size: 1.25rem;
    color: var(--color-text-light);
    margin-bottom: 2rem;
    max-width: 640px;
    margin-left: auto;
    margin-right: auto;
  }

  .hero-highlights {
    list-style: none;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.75rem;
    margin-top: 1.5rem;
  }

  .hero-highlights li {
    padding: 0.35rem 0.85rem;
    background: rgba(139, 90, 43, 0.1);
    border: 1px solid rgba(139, 90, 43, 0.2);
    border-radius: 999px;
    font-size: 0.95rem;
    color: var(--color-secondary);
  }

  .cta {
    display: inline-block;
    background: var(--color-accent);
    color: white;
    padding: 0.75rem 2rem;
    border-radius: 4px;
    font-weight: 600;
    font-size: 1rem;
  }

  .cta:hover {
    background: var(--color-accent-light);
  }

  /* Dark mode hero */
  :global([data-theme="dark"]) .hero-highlights li {
    background: rgba(0, 163, 204, 0.15);
    border-color: rgba(0, 163, 204, 0.3);
  }

  .hero-media-section {
    position: relative;
    width: 100%;
  }

  .hero-media {
    position: relative;
    overflow: hidden;
    width: 100%;
    aspect-ratio: 16 / 9;
    /* 완전히 닫힌 상태로 시작 */
    clip-path: polygon(50% 0%, 50% 0%, 50% 100%, 50% 100%);
    transition: clip-path 3.5s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .hero-media.revealed {
    /* 열린 상태 */
    clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%);
  }

  .hero-media img,
  .hero-media iframe,
  .hero-media video {
    width: 100%;
    height: 100%;
    border: none;
    object-fit: cover;
  }

  @media (max-width: 768px) {
    .hero-text {
      padding: 60px 16px;
    }

    .hero-text h1 {
      font-size: 2rem;
    }

    .hero-text p {
      font-size: 1.1rem;
    }

    .hero-media {
      aspect-ratio: 4 / 3;
    }
  }
</style>
