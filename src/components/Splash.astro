---
// 홈페이지에서만 스플래시 렌더링
const isHomePage = Astro.url.pathname === '/';
---

<script is:inline>
  const SPLASH_KEY = 'deckctr_splash_shown';
  const FORCE_KEY = 'deckctr_splash_force';
  const SPLASH_DELAY = 1500;
  const FADE_DURATION = 800;

  function safeGet(key) {
    try {
      return sessionStorage.getItem(key);
    } catch (error) {
      return null;
    }
  }

  function safeSet(key, value) {
    try {
      sessionStorage.setItem(key, value);
    } catch (error) {
      // Storage may be unavailable in private modes.
    }
  }

  function safeRemove(key) {
    try {
      sessionStorage.removeItem(key);
    } catch (error) {
      // Storage may be unavailable in private modes.
    }
  }

  const shouldSkipSplash = safeGet(SPLASH_KEY) && !safeGet(FORCE_KEY);
  if (shouldSkipSplash) {
    document.documentElement.classList.add('splash-skip');
  }

  function markForceSplash(event) {
    const key = event.key ? event.key.toLowerCase() : '';
    const isReloadShortcut = event.shiftKey && (event.metaKey || event.ctrlKey) && key === 'r';
    if (!isReloadShortcut) return;
    safeSet(FORCE_KEY, 'true');
  }

  document.addEventListener('keydown', markForceSplash);

  function initSplash() {
    const splash = document.getElementById('splash');
    const forceSplash = safeGet(FORCE_KEY) === 'true';

    if (forceSplash) {
      safeRemove(FORCE_KEY);
      safeRemove(SPLASH_KEY);
    }

    if (!splash) return;

    if (!forceSplash && safeGet(SPLASH_KEY)) {
      splash.classList.add('hidden', 'removed');
      window.dispatchEvent(new CustomEvent('splash:complete'));
      return;
    }

    document.body.style.overflow = 'hidden';

    setTimeout(() => {
      splash.classList.add('hidden');
      safeSet(SPLASH_KEY, 'true');

      setTimeout(() => {
        splash.classList.add('removed');
        document.body.style.overflow = '';
        window.dispatchEvent(new CustomEvent('splash:complete'));
      }, FADE_DURATION);
    }, SPLASH_DELAY);
  }

  document.addEventListener('astro:page-load', initSplash);
</script>

{isHomePage && (
  <div class="splash" id="splash" aria-hidden="true">
    <img src="/images/Logo_Urizen.svg" alt="" class="logo" />
  </div>
)}

<style>
  .splash {
    position: fixed;
    inset: 0;
    z-index: var(--z-splash, 10000);
    display: flex;
    align-items: center;
    justify-content: center;
    background: #ffffff;
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transition: opacity 0.8s ease-out, visibility 0.8s ease-out;
  }

  .splash.hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
  }

  .splash.removed {
    display: none;
  }

  :global(html.splash-skip) .splash {
    display: none;
  }

  .logo {
    width: min(280px, 70vw);
  }

</style>
